<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>fdm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8fd1faf6fd93e4e6d207ae0f9db51d78.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ortsdiskretisierung mit der Finite-Differenz-Methode</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="von-den-grundgleichungen-zum-linearen-gleichungssystem" class="level2">
<h2 class="anchored" data-anchor-id="von-den-grundgleichungen-zum-linearen-gleichungssystem">Von den Grundgleichungen zum linearen Gleichungssystem</h2>
<center>
<video data-autoplay="" data-src="assets/DNS_cylinder.avi.mp4" loop="loop" width="600">
</video>
</center>
<p><strong>Ziel</strong></p>
<p>Aufstellen eines linearen Gleichungssystems, dass mit numerischen Algorithmen gelöst werden kann.</p>
<p><strong>Zunächst</strong></p>
<p>Stationäres Problem <span class="math inline">\(\rightarrow \pp{}{t} = 0\)</span></p>
</section>
<section id="vorgehensweise-in-der-numerischen-strömungsmechanik" class="level2">
<h2 class="anchored" data-anchor-id="vorgehensweise-in-der-numerischen-strömungsmechanik">Vorgehensweise in der numerischen Strömungsmechanik</h2>
<ol type="1">
<li><p>Technisches Problem</p>
<p><em>Modellierung</em></p></li>
<li><p>Mathematische Beschreibung</p>
<p><em>Diskretisierung</em></p>
<ul>
<li>Rechengitter</li>
<li>Diskretisierung mit Finite-Differenzen</li>
<li>Diskretisierung für 1. und 2. Ableitung</li>
<li>Randbedingungen</li>
<li>Form des linearen Gleichungssystems</li>
</ul></li>
<li><p>Numerische Lösung</p>
<p><em>Visualisierung</em></p></li>
<li><p>Auswertung</p>
<p><em>Expertise, Experimente</em></p></li>
<li><p>Validierung der Ergebnisse</p></li>
</ol>
</section>
<section id="diskretisierung" class="level2">
<h2 class="anchored" data-anchor-id="diskretisierung">Diskretisierung</h2>
<section id="allgemeine-hinweise" class="level3">
<h3 class="anchored" data-anchor-id="allgemeine-hinweise">Allgemeine Hinweise</h3>
<ul>
<li>Die mathematischen Gleichungen können in der Regel nicht analytisch gelöst werden
<ul>
<li>Daher Anwendung von numerischer Strömungsmechanik</li>
</ul></li>
<li>Zur Anwendung numerischer Methoden ist eine diskrete Darstellung der Lösung erforderlich
<ul>
<li>Die Lösung kann nicht an jeder Stelle des Rechengebiets berechnet werden</li>
<li>Durch die diskrete Darstellung erhält man die Lösung in den diskreten Punkten</li>
<li>Die diskreten Punkte sind durch das verwendete Rechengitter definiert, das für eine Strömungssimulation erstellt werden muss</li>
</ul></li>
</ul>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm-fvm0000.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm-fvm0001.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="500"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="diskretisierung-1" class="level2">
<h2 class="anchored" data-anchor-id="diskretisierung-1">Diskretisierung</h2>
<section id="übliche-methoden-und-anschauungsbeispiel" class="level3">
<h3 class="anchored" data-anchor-id="übliche-methoden-und-anschauungsbeispiel">Übliche Methoden und Anschauungsbeispiel</h3>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/pt_mesh.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div><div class="column">
<p><strong>Übliche Diskretisierungsmethoden</strong></p>
<ul>
<li>Finite-Differenzen-Methode
<ul>
<li>Anschaulich</li>
<li>In diesem Kapitel der Vorlesung behandelt</li>
</ul></li>
<li>Finite-Volumen-Methode
<ul>
<li>Häufig für CFD-Anwendungen, z.B. OpenFOAM, ANSYS Fluent, …</li>
</ul></li>
<li>Finite-Element-Methode
<ul>
<li>Unüblich für CFD-Anwendungen</li>
<li>Nicht im Rahmen der Vorlesung behandelt</li>
</ul></li>
</ul>
</div>
</div>
<ul>
<li>Die Berechnung erfolgt basierend auf dem verwendeten Rechennetz</li>
<li>Die Unbekannten werden entweder auf dem Schnittpunkt der Gitterlinien oder in der Zellmitte durchgeführt</li>
</ul>
</section>
</section>
<section id="finite-differenzen-methode" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode">Finite-Differenzen-Methode</h2>
<section id="vorgehensweise" class="level3">
<h3 class="anchored" data-anchor-id="vorgehensweise">Vorgehensweise</h3>
<div class="columns">
<div class="column">
<p><strong>1. Erstellen des Rechengitters</strong></p>
<ul>
<li>Orthogonales Netz</li>
<li>Nicht äquidistant</li>
</ul>
</div><div class="column">
<div id="08e84824" class="cell" data-message="false" data-execution_count="1">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-2-output-1.png" width="823" height="226" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<p><strong>2. Appproximation der Differentialquotienten durch Differenzenquotienten</strong></p>
<ul>
<li>Genauigkeit der Approximation</li>
</ul>
</div><div class="column">
<p><span class="math display">\[
\pp{\phi}{x} = \dd{\phi}{x} + \text{Abbruchfehler} \approx \dd{\phi}{x}
\]</span></p>
</div>
</div>
<div class="columns">
<div class="column">
<p><strong>3. Aufstellen des Linearen Gleichungssystems</strong></p>
<ul>
<li>Berücksichtigung von Randbedingungen</li>
</ul>
</div><div class="column">
<p><span class="math display">\[
{\tiny
\begin{bmatrix}
\blacksquare &amp; \blacksquare &amp; 0  &amp; \dots &amp; \dots &amp; \dots &amp; 0\\
\blacksquare &amp; \ddots &amp; \ddots &amp; 0 &amp; &amp; &amp; \vdots\\
0 &amp; \ddots &amp; \ddots  &amp; \ddots &amp; 0 &amp;  &amp; \vdots\\
\vdots &amp; 0 &amp; \blacksquare  &amp; \blacksquare &amp; \blacksquare&amp; 0 &amp; \vdots\\
\vdots &amp; &amp; 0 &amp; \ddots &amp; \ddots&amp; \ddots &amp; 0\\
\vdots &amp; &amp; &amp; 0 &amp; \ddots&amp; \ddots &amp; \blacksquare\\
0 &amp; \dots &amp; \dots  &amp; \dots &amp; 0 &amp; \blacksquare &amp; \blacksquare\\
\end{bmatrix}
\begin{bmatrix}
\phi_1 \\
\vdots \\
\phi_m \\
\vdots \\
\phi_N \\
\end{bmatrix}
= \begin{bmatrix}
0 \\
\vdots \\
0 \\
\vdots \\
0 \\
\end{bmatrix}
\mathrm{mit} \; \blacksquare \; \mathrm{für\ Einträge} \neq 0
}
\]</span></p>
</div>
</div>
<div class="columns">
<div class="column">
<p><strong>4. Lösung</strong></p>
</div><div class="column">
<p><span class="math display">\[
\vec{\phi}^{(n+1)} = f(\vec{\phi}^{(n)})
\]</span></p>
</div>
</div>
</section>
</section>
<section id="finite-differenzen-methode-1" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-1">Finite-Differenzen-Methode</h2>
<section id="erstellen-des-rechengitters-14" class="level3">
<h3 class="anchored" data-anchor-id="erstellen-des-rechengitters-14">Erstellen des Rechengitters (1/4)</h3>
<p><strong>Beispiel:</strong> Betrachtung eines ein- und zweidimensionalen Berechnungsgebiets mit <span class="math inline">\(N\)</span> und <span class="math inline">\(N \times M\)</span> Knoten</p>
<div id="f3b66e05" class="cell" data-message="false" data-execution_count="2">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-3-output-1.png" width="1658" height="575" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Im Allgemeinen muss das Gitter strukturiert und rechtwinklig (kartesisch) sein.</p>
</div>
</div>
</section>
</section>
<section id="finite-differenzen-methode-2" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-2">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<ul>
<li>Je nachdem welche Differentialgleichung gelöst wird, werden meist für eine Unbekannte <span class="math inline">\(\phi\)</span> die Ableitungen <span class="math inline">\(\pp{\phi}{x}\)</span>, <span class="math inline">\(\pp{^2 \phi}{x^2}\)</span> und <span class="math inline">\(\pp{\phi}{t}\)</span> benötigt. Diese kommen z.B. in den folgenden Gleichungen vor:
<ul>
<li><span class="math inline">\(\pp{\phi}{t} - \beta \pp{^2\phi}{x^2} = 0\)</span></li>
<li><span class="math inline">\(\pp{\phi}{t} + \alpha \pp{\phi}{x} = 0\)</span></li>
<li><span class="math inline">\(\pp{\phi}{t} + \phi \pp{\phi}{x} = 0\)</span></li>
</ul></li>
<li>Orts- und Zeitableitung werden prinzipiell durch das gleiche Schema abgeleitet</li>
</ul>
</section>
</section>
<section id="finite-differenzen-methode-3" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-3">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-graphisch-24" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-graphisch-24">Appproximation der Differentialquotienten durch Differenzenquotienten (graphisch) (2/4)</h3>
<div id="4222b5b8" class="cell" data-message="false" data-execution_count="3">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-4-output-1.png" width="1233" height="307" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Das Differential für <span class="math inline">\(\pp{\phi}{x}\)</span> an der Stelle <span class="math inline">\(x=x_i\)</span>, also <span class="math inline">\(\ppb{\phi(x_i)}{x}
  = \at{\pp{\phi}{x}}{x=x_i}
  = \at{\pp{\phi}{x}}{i}
  \approx
  \at{\dd{\phi}{x}}{i}\)</span>, wird durch unterschiedliche Differenzen approximiert:</p>
<ul>
<li><p><span class="math inline">\(\frac{\phi(x_i + \Delta x) - \phi(x_i)}{(x_i + \Delta x) - (x_i)}
=
\fd{\phi}{i+1}{i}{\Delta x}\)</span> (Vorwärtsdifferenz)</p></li>
<li><p><span class="math inline">\(\frac{\phi(x_i) - \phi(x_i - \Delta x)}{(x_i) - (x_i - \Delta x)}
=
\fd{\phi}{i}{i-1}{\Delta x}\)</span> (Rückwärtsdifferenz)</p></li>
<li><p><span class="math inline">\(\frac{\phi(x_i + \Delta x) - \phi(x_i - \Delta x)}{(x_i + \Delta x) - (x_i - \Delta x)}
=
\fd{\phi}{i+1}{i-1}{2\Delta x}\)</span> (Zentrale Differenz)</p></li>
</ul>
<p>Die Differenz wird jeweils über unterschiedliche Intervalle gebildet. Bei der Vorwärts- und Rückwärtsdifferenz hat das Interval eine Länge von <span class="math inline">\(\Delta x\)</span>; bei der zentralen Differenz entspricht das Interval der doppelten Länge <span class="math inline">\(2 \Delta x\)</span>.</p>
</section>
</section>
<section id="finite-differenzen-methode-4" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-4">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-graphisch-24-1" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-graphisch-24-1">Appproximation der Differentialquotienten durch Differenzenquotienten (graphisch) (2/4)</h3>
<div id="a61b6fd9" class="cell" data-message="false" data-execution_count="4">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-5-output-1.png" width="1233" height="307" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Das Differential für <span class="math inline">\(\ppnd{\phi}{x}\)</span> an der Stelle <span class="math inline">\(x=x_i\)</span>, also <span class="math inline">\(\ppndb{\phi(x_i)}{x}
  = \at{\ppnd{\phi}{x}}{x=x_i}
  = \at{\ppnd{\phi}{x}}{i}
  = \at{\pp{}{x} \left( \pp{\phi}{x} \right)}{i}
  \approx
  \at{\dd{}{x} \left( \dd{\phi}{x} \right)}{i}\)</span>, lässt sich in zwei Differenzen “unterteilen”: die Differenz aus Vorwärts- und Rückwärtsdifferenz von <span class="math inline">\(\phi\)</span>. Es ergibt sich damit die Approximation von <span class="math inline">\(\at{\ppnd{\phi}{x}}{i}\)</span> zu:</p>
<p><span class="math display">\[
\frac{1}{\Delta x}\left(
\fd{\phi}{i+1}{i}{\Delta x}
-
\fd{\phi}{i}{i-1}{\Delta x}
\right)
=
\frac{\phi_{i+1}-2\phi_i+\phi_{i-1}}{\bdx{2}}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-5" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-5">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-1" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-1">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Die systematische Herleitung von Approximationen erfolgt über die Taylorreihe. Allgemein wird eine eindimensionale Funktion <span class="math inline">\(f(x)\)</span> über den Entwicklungspunkt <span class="math inline">\(a\)</span> durch <span class="math display">\[
T_m f(x;a) = \sum_{n=0}^{(m-1)} \frac{(x-a)^n}{n!} \at{\pp{^n f(x)}{x^n}}{x=a}
\]</span> angenährt. Mit steigendem <span class="math inline">\(m\)</span> wird die Näherung genauer; entsprechend konvergiert sie für <span class="math inline">\(m \rightarrow \infty\)</span> für viele Funktionen gegen diese.</p>
<p><strong>Taylorreihe bis zur Ableitung 3. Ordnung:</strong></p>
<p><span class="math display">\[
\begin{align}
T_4 f(x;a)
&amp;=
\sum_{n=0}^{3} \frac{(x-a)^n}{n!} \at{\pp{^n f}{x^n}}{a} \\
&amp;=
\frac{(x-a)^0}{0!} \at{\pp{^0 f}{x^0}}{a}
+
\frac{(x-a)^1}{1!} \at{\pp{^1 f}{x^1}}{a}
+
\frac{(x-a)^2}{2!} \at{\pp{^2 f}{x^2}}{a}
+
\frac{(x-a)^3}{3!} \at{\pp{^3 f}{x^3}}{a} \\
&amp;=
\at{f}{a}
+
(x-a) \at{\pp{f}{x}}{a}
+
\frac{(x-a)^2}{2} \at{\pp{^2 f}{x^2}}{a}
+
\frac{(x-a)^3}{6} \at{\pp{^3 f}{x^3}}{a}
\end{align}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-6" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-6">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-2" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-2">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<div id="2ee5eef6" class="cell" data-message="false" data-execution_count="5">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-6-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1238" height="307"></p>
</figure>
</div>
</div>
</div>
<p><strong>Vergleich unterschiedlicher Annäherungen mit dem Entwicklungspunkt <span class="math inline">\(x_i\)</span>:</strong></p>
<p><span class="math display">\[
\begin{align}
T_2 f(x;x_i)
&amp;=
\at{f}{x_i}
+
(x-x_i) \at{\pp{f}{x}}{x_i} \\
T_3 f(x;x_i)
&amp;=
\at{f}{x_i}
+
(x-x_i) \at{\pp{f}{x}}{x_i}
+
\frac{(x-x_i)^2}{2} \at{\pp{^2 f}{x^2}}{x_i} \\
T_4 f(x;x_i)
&amp;=
\at{f}{x_i}
+
(x-x_i) \at{\pp{f}{x}}{x_i}
+
\frac{(x-x_i)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
+
\frac{(x-x_i)^3}{6} \at{\pp{^3 f}{x^3}}{x_i} \\
\end{align}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-7" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-7">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-3" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-3">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Auswertung des Taylorpolynoms <span class="math inline">\(T_4\)</span> um den Entwicklungspunkt <span class="math inline">\(x_i\)</span> an der Stelle <span class="math inline">\(x_i + \Delta x\)</span> liefert:</p>
<p><span class="math display">\[
\begin{align}
T_4 f(\underbrace{x_i + \Delta x}_{x};x_i)
&amp;=
\at{f}{x_i}
+
(\underbrace{x_i + \Delta x}_{x} - x_i) \at{\pp{f}{x}}{x_i}
+
\frac{(\overbrace{x_i + \Delta x}^{x} - x_i)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
+
\frac{(\overbrace{x_i + \Delta x}^{x} - x_i)^3}{6} \at{\pp{^3 f}{x^3}}{x_i} \\
&amp;=
\at{f}{x_i}
+
(\Delta x) \at{\pp{f}{x}}{x_i}
+
\frac{(\Delta x)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
+
\frac{(\Delta x)^3}{6} \at{\pp{^3 f}{x^3}}{x_i}
\end{align}
\]</span></p>
<p>Die vollständige Taylorreihe an der Stelle <span class="math inline">\(x_i + \Delta x\)</span> konvergiert also gegen den Funktionswert:</p>
<p><span class="math display">\[
\begin{align}
f(x_i + \Delta x)
=
\at{f}{x_i}
+
(\Delta x) \at{\pp{f}{x}}{x_i}
+
\frac{(\Delta x)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
+
\frac{(\Delta x)^3}{6} \at{\pp{^3 f}{x^3}}{x_i}
+
...
\end{align}
\]</span></p>
<p>Entsprechendes gilt für die Taylorreihe an der Stelle <span class="math inline">\(x_i - \Delta x\)</span>:</p>
<p><span class="math display">\[
\begin{align}
f(x_i - \Delta x)
=
\at{f}{x_i}
-
(\Delta x) \at{\pp{f}{x}}{x_i}
+
\frac{(\Delta x)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
-
\frac{(\Delta x)^3}{6} \at{\pp{^3 f}{x^3}}{x_i}
+
...
\end{align}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-8" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-8">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-4" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-4">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Zur Herleitung der Vorwärtsdifferenz wird die Taylorreihe</p>
<p><span class="math display">\[
\begin{align}
\underbrace{f(x_i + \Delta x)}_{=\at{f}{x_{i+1}}}
=
\at{f}{x_i}
+
(\Delta x) \at{\pp{f}{x}}{x_i}
+
\frac{(\Delta x)^2}{2} \at{\pp{^2 f}{x^2}}{x_i}
+
\frac{(\Delta x)^3}{6} \at{\pp{^3 f}{x^3}}{x_i}
+
\underbrace{...}_{=\Odx{4})}
\end{align}
\]</span></p>
<p>mit dem Abbruchfehler (Fehlerterm) <span class="math inline">\(\Odx{4})\)</span> nach der ersten Ableitung <span class="math inline">\(\at{\pp{f}{x}}{x_i}\)</span> umgestellt:</p>
<p><span class="math display">\[
\begin{align}
\underbrace{\at{\pp{f}{x}}{x_i}}_{=\at{\pp{f}{x}}{i}}
&amp;=
\underbrace{
  \frac{\at{f}{x_{i+1}} - \at{f}{x_i}}{\Delta x}
}_{
  \frac{f_{i+1}-f_i}{\Delta x}
}
-
\underbrace{
  \frac{(\Delta x)^2}{2 \Delta x} \at{\pp{^2 f}{x^2}}{x_i}
  -
  \frac{(\Delta x)^3}{6 \Delta x} \at{\pp{^3 f}{x^3}}{x_i}
  -
  \frac{\Odx{4})}{\Delta x}
}_{\Odx{1}}
\\
\at{\pp{f}{x}}{i}
&amp;=
\frac{f_{i+1}-f_i}{\Delta x}
+
\underbrace{
  \Odx{1}
}_{
  \text{Führender Fehlerterm}
}
\approx \frac{f_{i+1}-f_i}{\Delta x}
\end{align}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Der <strong>Führende Fehlerterm</strong> gibt die Fehlerordnung des Diskretisierungsschemas vor.</li>
<li>Es ist der erste Term, der nicht für die Approximation verwendet wird.</li>
<li>Die folgenden Fehlerterme mit einer höheren Ordnung haben in der Regel einen geringeren Einfluss.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="finite-differenzen-methode-9" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-9">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-5" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-5">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Zur Herleitung der Rückwärtsdifferenz wird die Taylorreihe</p>
<p><span class="math display">\[
\begin{align}
\at{f}{i-1}
=
\at{f}{i}
-
\dx \at{\pp{f}{x}}{i}
+
\frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
-
\frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
\underbrace{...}_{=\Odx{4})}
\end{align}
\]</span></p>
<p>wieder nach der ersten Ableitung <span class="math inline">\(\at{\pp{f}{x}}{i}\)</span> umgestellt:</p>
<p><span class="math display">\[
\begin{align}
\at{\pp{f}{x}}{i}
&amp;=
\fd{f}{i}{i-1}{\Delta x}
+
\Odx{1}
\end{align}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-10" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-10">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-6" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-6">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Zur Herleitung weiterer Diskretisierungsschemata werden die beiden Gleichungen <span class="math display">\[
\begin{align}
\at{f}{i+1}
=
\at{f}{i}
+
\dx \at{\pp{f}{x}}{i}
+
\frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
+
\frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
\Odx{4}
\end{align}
\]</span> und <span class="math display">\[
\begin{align}
\at{f}{i-1}
=
\at{f}{i}
-
\dx \at{\pp{f}{x}}{i}
+
\frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
-
\frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
\Odx{4}
\end{align}
\]</span> zu <span class="math display">\[
\begin{align}
a \at{f}{i+1}
+
b \at{f}{i-1}
=
(a+b) \at{f}{i}
+
(a-b) \dx \at{\pp{f}{x}}{i}
+
(a+b) \frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
+
(a-b) \frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
(a+b) \Odx{4}
\end{align}
\]</span> kombiniert.</p>
<p>Eine geschickte Wahl von <span class="math inline">\(a\)</span> und <span class="math inline">\(b\)</span> liefert dann Diskretisierungsschemata für gewünschte Ableitungen und Fehlerordnungen.</p>
</section>
</section>
<section id="finite-differenzen-methode-11" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-11">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-7" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-7">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Zur Herleitung der Zentralen Differenz müssen folgende Bedingungen gelten: <span class="math display">\[
\begin{align}
a \at{f}{i+1}
+
b \at{f}{i-1}
=
(a+b) \at{f}{i}
+
\underbrace{(a-b)}_{=1} \dx \at{\pp{f}{x}}{i}
+
\underbrace{(a+b)}_{=0} \frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
+
(a-b) \frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
(a+b) \Odx{4}
\end{align}
\]</span></p>
<p>Es ergibt sich <span class="math inline">\(a=\frac{1}{2}\)</span> und <span class="math inline">\(b=-\frac{1}{2}\)</span>. Damit ergibt sich folgendes Diskretisierungsschema:</p>
<p><span class="math display">\[
\at{\pp{f}{x}}{i} = \fd{f}{i+1}{i-1}{2\dx} + \Odx{2}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Im Vergleich zu den bisherigen Schemata hat die Zentrale Differenz einen führenden Fehlerterm mit der Ordnung 2 für die Appoximation der ersten Ableitung.</p>
</div>
</div>
</section>
</section>
<section id="finite-differenzen-methode-12" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-12">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-8" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-8">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Zur Herleitung einer Appoximation für die zweite Ableitung müssen folgende Bedingungen gelten: <span class="math display">\[
\begin{align}
a \at{f}{i+1}
+
b \at{f}{i-1}
=
(a+b) \at{f}{i}
+
\underbrace{(a-b)}_{=0} \dx \at{\pp{f}{x}}{i}
+
\underbrace{(a+b)}_{=1} \frac{\bdx{2}}{2} \at{\pp{^2 f}{x^2}}{i}
+
(a-b) \frac{\bdx{3}}{6} \at{\pp{^3 f}{x^3}}{i}
+
(a+b) \Odx{4}
\end{align}
\]</span></p>
<p>Es ergibt sich <span class="math inline">\(a=\frac{1}{2}\)</span> und <span class="math inline">\(b=\frac{1}{2}\)</span>. Damit ergibt sich folgendes Diskretisierungsschema:</p>
<p><span class="math display">\[
\at{\ppnd{f}{x}}{i} = \ffd{f}{i+1}{i}{i-1}{\dx^2} + \Odx{2}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-13" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-13">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-9" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-9">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<p>Die Approximationen für eindimensionale Probleme können einfach auf zwei- oder dreidimensionale Probleme angewendet werden.</p>
<section id="beispiele-in-zwei-dimensionen" class="level4">
<h4 class="anchored" data-anchor-id="beispiele-in-zwei-dimensionen">Beispiele in zwei Dimensionen</h4>
<div class="columns">
<div class="column">
<p>Vorwärtsdifferenz</p>
<p><span class="math display">\[
\begin{align}
\at{\pp{f}{x}}{i,j} \approx \fd{f}{i+1,j}{i,j}{\dx}
\; \text{und} \;
\at{\pp{f}{y}}{i,j} \approx \fd{f}{i,j+1}{i,j}{\dy}
\end{align}
\]</span></p>
<p>Rückwärtsdifferenz</p>
<p><span class="math display">\[
\begin{align}
\at{\pp{f}{x}}{i,j} \approx \fd{f}{i,j}{i-1,j}{\dx}
\; \text{und} \;
\at{\pp{f}{y}}{i,j} \approx \fd{f}{i,j}{i,j-1}{\dy}
\end{align}
\]</span></p>
<p>Zentrale Differenz</p>
<p><span class="math display">\[
\begin{align}
\at{\pp{f}{x}}{i,j} \approx \fd{f}{i+1,j}{i-1,j}{2 \dx}
\; \text{und} \;
\at{\pp{f}{y}}{i,j} \approx \fd{f}{i,j+1}{i,j-1}{2 \dy}
\end{align}
\]</span></p>
</div><div class="column">
<p><span class="math display">\[
\begin{align}
\at{\ppnd{f}{x}}{i,j} &amp;\approx \ffd{f}{i+1,j}{i,j}{i-1,j}{\dx^2}\\
\at{\ppnd{f}{y}}{i,j} &amp;\approx \ffd{f}{i,j+1}{i,j}{i,j-1}{\dy^2}
\end{align}
\]</span></p>
<div id="e828c9d5" class="cell" data-message="false" data-execution_count="6">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-7-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="373" height="338"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="finite-differenzen-methode-14" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-14">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-10" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-10">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="anmerkungen-zum-diskretisierungsfehler" class="level4">
<h4 class="anchored" data-anchor-id="anmerkungen-zum-diskretisierungsfehler">Anmerkungen zum Diskretisierungsfehler</h4>
<p>Die Fehlerordnung bezieht sich auf die Konvergenzrate bei Gitterverfeinerung.</p>
<div id="0e83236e" class="cell" data-message="false" data-execution_count="7">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-8-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="941" height="456"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Ein Verfahren mit hoher Fehlerordnung bedeutet nicht unbedingt auch einen kleineren Fehler.</li>
<li>Für die 1. Ordung halbiert sich theoretisch der Fehler bei Verdopplung der Knotenanzahl; entsprechend viertelt sich der Fehler bei der 2. Ordnung</li>
<li>Es kann gezeigt werden, dass die Fehlerordnung auf nichtäquidistanten gleich der auf äquidistanten Gittern ist.</li>
</ul>
</div>
</div>
</section>
</section>
</section>
<section id="finite-differenzen-methode-15" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-15">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-11" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-11">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="anmerkungen-zum-diskretisierungsfehler-1" class="level4">
<h4 class="anchored" data-anchor-id="anmerkungen-zum-diskretisierungsfehler-1">Anmerkungen zum Diskretisierungsfehler</h4>
<ul>
<li>Die Idee hinter der Verwendung von nichtäquidistanten Gittern ist, dass der Diskretisierungsfehler nicht nur von der Gitterweite <span class="math inline">\(\dx\)</span>, sondern auch von den Ableitungen der Variablen (z.B. <span class="math inline">\(\frac{\dx}{2!} \at{\ppnd{f}{x}}{i}\)</span>) abhängt.</li>
</ul>
<div id="e20b6c9a" class="cell" data-message="false" data-execution_count="8">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-9-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1233" height="172"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Der Diskretisierungsfehler hängt von der gewählten Approximation sowie der Gitterweite ab.</li>
<li>Approximationen höherer Ordnung lassen sich ebenfalls herleiten. Diese resultieren in einem größeren Differenzenstern und somit erhöhtem Berechnungsaufwand, z. B. eine Rückwärtsdifferenz für die erste Ableitung aus den Knoten <span class="math inline">\(i\)</span>, <span class="math inline">\(i-1\)</span> und <span class="math inline">\(i-2\)</span>.</li>
</ul>
<div class="columns">
<div class="column" style="width:30%;">
<div id="278564d6" class="cell" data-message="false" data-execution_count="9">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-10-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="317" height="81"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:40%;">
<p><span class="math inline">\(\leftarrow\)</span> Verfahren 1. Ordnung <span class="math inline">\(\leftrightarrow\)</span> Verfahren 2. Ordnung <span class="math inline">\(\rightarrow\)</span></p>
</div><div class="column" style="width:30%;">
<div id="8ea3293c" class="cell" data-message="false" data-execution_count="10">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-11-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="317" height="81"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<ul>
<li>Im Idealfall sollten alle Terme (inklusive Randbedingungen) mit Approximationen gleicher Ordnung diskretisiert werden.</li>
</ul>
</section>
</section>
</section>
<section id="finite-differenzen-methode-16" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-16">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-12" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-12">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="aufwind-upwind-diskretisierung-vs.-zentrale-differenz" class="level4">
<h4 class="anchored" data-anchor-id="aufwind-upwind-diskretisierung-vs.-zentrale-differenz">Aufwind (Upwind) Diskretisierung vs.&nbsp;Zentrale Differenz</h4>
<ul>
<li>Bei Transportgleichungen mit dominanter Konvektion liegt eine Richtungsabhängigkeit vor. Diese wird mit einer Zentralen Differenz nicht berücksichtigt.</li>
<li>Physikalisch gesehen hat dann der stromauf gelegene Knoten mehr Einfluss als der stromab gelegene.</li>
<li>Das einfachste Diskretisierungsschema, das die Richtungsabhängigkeit berücksichtigt, ist ein Aufwind-Verfahren, das je nach Strömungsrichtung eine Vorwärts- oder Rückwärtsdifferenz verwendet.</li>
</ul>
<p><strong>Beispiel:</strong></p>
<p>Je nach Vorzeichen der Geschwindigeit <span class="math inline">\(\alpha\)</span> in der Gleichung <span class="math inline">\(\pp{\phi}{t} + \alpha \pp{\phi}{x} = 0\)</span> wird das Diskretisierungsschema für den Konvektionsterm angepasst:</p>
<p><span class="math display">\[
\pp{\phi}{x}
=
\begin{cases}
\fd{\phi}{i}{i-1}{\dx} \, \text{wenn} \, \alpha&gt;0 \\
\fd{\phi}{i+1}{i}{\dx} \, \text{sonst}
\end{cases}
\]</span></p>
<div id="55f1ee23" class="cell" data-message="false" data-execution_count="11">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-12-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1135" height="196"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="finite-differenzen-methode-17" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-17">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-13" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-13">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="aufwind-upwind-diskretisierung-vs.-zentrale-differenz-1" class="level4">
<h4 class="anchored" data-anchor-id="aufwind-upwind-diskretisierung-vs.-zentrale-differenz-1">Aufwind (Upwind) Diskretisierung vs.&nbsp;Zentrale Differenz</h4>
<ul>
<li><p>Für Strömungsvorgänge definiert die <span class="math inline">\(Re\)</span>-Zahl das Verhältnis aus Trägheits- und Reibkräften, also genau das Verhältnis aus Konvektion und Diffusion; entsprechend muss bei hohen <span class="math inline">\(Re\)</span>-Zahlen eine Aufwind-Diskretisierung angewendet werden.</p></li>
<li><p>In der Energiegleichung definiert die <span class="math inline">\(Pe\)</span>-Zahl (Peclet-Zahl) das Verhältnis aus Konvektion und Diffusion</p></li>
<li><p>Bei dominierender Konvektion kann es bei Verwendung einer zentralen Differenz für die Diskretisierung des Konvektionsterms zu unphysikalischen Oszillationen in der Lösung kommen.</p></li>
<li><p>Der Grund für die unphysikalischen Oszillationen ist, dass die Matrix im linearen Gleichungssystem bei Verwendung einer Diskretisierung mit zentralen Differenzen nicht mehr diagonaldominant ist.</p>
<ul>
<li>Das bedeutet, dass die Koeffizienten der Hauptdiagonale nicht mehr größer sind als die Summe der weiteren Einträge in dieser Zeile.</li>
</ul></li>
<li><p>Es kann gezeigt werden, dass eine Zentrale Differenz nur stabil ist, sofern folgende Bedingung für die Geschwindigkeit <span class="math inline">\(v\)</span>, die Gitterweite <span class="math inline">\(\dx\)</span> und der Diffusionskonstanten <span class="math inline">\(\alpha\)</span> bzw. <span class="math inline">\(\nu\)</span> in einem jeweiligen Element gilt:</p>
<p><span class="math display">\[
Pe_{\text{Element}} = \frac{v \dx}{\alpha} &lt; 2
\;
\text{bzw.}
\;
Re_{\text{Element}} = \frac{v \dx}{\nu} &lt; 2
\]</span></p></li>
</ul>
</section>
</section>
</section>
<section id="finite-differenzen-methode-18" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-18">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-14" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-14">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="verhalten-des-diskretisierungsfehlers" class="level4">
<h4 class="anchored" data-anchor-id="verhalten-des-diskretisierungsfehlers">Verhalten des Diskretisierungsfehlers</h4>
<p>Zur Untersuchung wird in die Gleichung <span class="math inline">\(\pp{\phi}{t}+\alpha \pp{\phi}{x} = 0\)</span> statt dem Diskretisierungsschema die Ableitung und der führende Fehlerterm eingesetzt:</p>
<div class="columns">
<div class="column">
<p>Die Rückwärtsdifferenz <span class="math display">\[\at{\pp{\phi}{x}}{i}
\approx
\fd{\phi}{i}{i-1}{\dx}
+
\frac{\dx}{2} \at{\ppnd{\phi}{x}}{i}
\]</span> wird umgestellt zu <span class="math display">\[\fd{\phi}{i}{i-1}{\dx}
\approx
\at{\pp{\phi}{x}}{i}
-
\frac{\dx}{2} \at{\ppnd{\phi}{x}}{i}
\]</span> und in die Differentialgleichung eingesetzt. Es ergibt sich die effektiv zu lösende Gleichung als: <span class="math display">\[
\at{\pp{\phi}{t}}{t_i}
+
\alpha \left(
  \at{\pp{\phi}{x}}{i}
  -
  \frac{\dx}{2} \at{\ppnd{\phi}{x}}{i}
\right) \approx 0
\]</span></p>
<p>Der Fehlerterm hat diffusiven Charakter.</p>
</div><div class="column">
<p>Die Zentrale Differenz <span class="math display">\[
\at{\pp{\phi}{x}}{i}
\approx
\fd{\phi}{i+1}{i-1}{2\dx}
-
\frac{\dx}{6} \at{\pp{^3\phi}{x^3}}{i}
\]</span> wird umgestellt zu <span class="math display">\[
\fd{\phi}{i+1}{i-1}{2\dx}
\approx
\at{\pp{\phi}{x}}{i}
+
\frac{\dx}{6} \at{\pp{^3\phi}{x^3}}{i}
\]</span> und in die Differentialgleichung eingesetzt. Es ergibt sich die effektiv zu lösende Gleichung als: <span class="math display">\[
\at{\pp{\phi}{t}}{t_i}
+
\alpha \left(
  \at{\pp{\phi}{x}}{i}
  +
  \frac{\dx}{6} \at{\pp{^3\phi}{x^3}}{i}
\right) \approx 0
\]</span></p>
<p>Der Fehlerterm hat dispersiven Charakter.</p>
</div>
</div>
</section>
</section>
</section>
<section id="finite-differenzen-methode-19" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-19">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-15" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-15">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<section id="verhalten-des-diskretisierungsfehlers-1" class="level4">
<h4 class="anchored" data-anchor-id="verhalten-des-diskretisierungsfehlers-1">Verhalten des Diskretisierungsfehlers</h4>
<div class="columns">
<div class="column">
<p><strong>Diffusiver Fehler</strong></p>
<p><span class="math display">\[
\pp{\phi}{t}
+
\alpha \pp{\phi}{x}
-
\underbrace{\alpha \frac{\dx}{2} \ppnd{\phi}{x}}_{\text{Gerade Ableitung}}
\approx 0
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_diffError.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<ul>
<li>Gradienten werden geglättet</li>
<li>Beschränkt</li>
</ul>
</div><div class="column">
<p><strong>Dispersiver Fehler</strong></p>
<p><span class="math display">\[
\pp{\phi}{t}
+
\alpha \pp{\phi}{x}
+
\underbrace{\alpha \frac{\dx}{6} \pp{^3\phi}{x^3}}_{\text{Ungerade Ableitung}}
\approx 0
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_dispError.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%"></p>
</figure>
</div>
<ul>
<li>Numerische Oszillationen in der Lösung möglich</li>
<li>Unbeschränkt</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sofern die ursprüngliche Gleichung schon eine zweite Ableitung und damit Diffusion enthält, kann durch einen diffusiven Fehler diese erhöht werden. Das wird als zusätzliche numerische Diffusion bezeichnet.</p>
</div>
</div>
</section>
</section>
</section>
<section id="finite-differenzen-methode-20" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-20">Finite-Differenzen-Methode</h2>
<section id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-16" class="level3">
<h3 class="anchored" data-anchor-id="appproximation-der-differentialquotienten-durch-differenzenquotienten-24-16">Appproximation der Differentialquotienten durch Differenzenquotienten (2/4)</h3>
<ul>
<li><p>Es gibt eine Vielzahl möglicher Schemas für die Diskretisierung des Konvektionsterms, die für unterschiedliche Anwendungen entwickelt wurden.</p></li>
<li><p>Gängige Diskretisierungsschemas für praktische Anwendungen (z.B. Turbinensimulationen) sind:</p>
<ul>
<li>High Resolution:
<ul>
<li>Mischung aus Verfahren 1. und 2. Ordnung</li>
<li>Verfahren 2. Ordnung, wo möglich</li>
<li>Verfahren 1. Ordnung in Bereichen hoher Gradienten</li>
</ul></li>
<li>Linear Upwind (Aufwind-Diskretisierung 2.Ordnung) <span class="math display">\[
\at{\pp{\phi}{x}}{i} \approx \frac{\phi_{i+2}-4\phi_{i+1}+3\phi_i}{2\dx}
\;
\text{bzw.}
\;
\at{\pp{\phi}{x}}{i} \approx \frac{\phi_{i-2}-4\phi_{i-1}+3\phi_i}{2\dx}
\]</span></li>
</ul></li>
</ul>
</section>
</section>
<section id="finite-differenzen-methode-21" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-21">Finite-Differenzen-Methode</h2>
<section id="aufstellen-des-linearen-gleichungssystems-34" class="level3">
<h3 class="anchored" data-anchor-id="aufstellen-des-linearen-gleichungssystems-34">Aufstellen des linearen Gleichungssystems (3/4)</h3>
<p>Durch Einsetzen der Differenzenquotienten erhält man die diskretisierte Gleichung zur Berechnung der inneren Knoten.</p>
<p><strong>Beispiel:</strong></p>
<p>Die Gleichung <span class="math display">\[
u \pp{\phi}{x} - \beta \ppnd{\phi}{x} = 0
\]</span> mit der unbekannten Größe <span class="math inline">\(\phi\)</span> lautet nach einer möglichen Diskretisierung für den Knoten <span class="math inline">\(i\)</span>: <span class="math display">\[
u_i \fd{\phi}{i+1}{i-1}{2\dx} - \beta_i \ffd{\phi}{i+1}{i}{i-1}{\dx^2} = 0
\]</span> Umgestellt lautet die Gleichung: <span class="math display">\[
\left(
\frac{u_i}{2\dx}
-
\frac{\beta}{\dx^2}
\right)
\phi_{i+1}
+
\left(
\frac{2\beta}{\dx^2}
\right)
\phi_{i}
+
\left(
-
\frac{u_i}{2\dx}
-
\frac{\beta}{\dx^2}
\right)
\phi_{i-1}
=
0
\]</span> Diese Gleichung wird für jeden anderen inneren Knoten ebenfalls aufgestellt.</p>
</section>
</section>
<section id="finite-differenzen-methode-22" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-22">Finite-Differenzen-Methode</h2>
<section id="aufstellen-des-linearen-gleichungssystems-34-1" class="level3">
<h3 class="anchored" data-anchor-id="aufstellen-des-linearen-gleichungssystems-34-1">Aufstellen des linearen Gleichungssystems (3/4)</h3>
<p>Es ergibt sich das lineare Gleichungssystem <span class="math inline">\(\mat{A} \vec{\phi} = \vec{b}\)</span>. Die Matrix hat für die gewählte Diskretisierung auf dem Gitter drei Bänder.</p>
<div id="47ee51b6" class="cell" data-message="false" data-execution_count="12">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-13-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1135" height="110"></p>
</figure>
</div>
</div>
</div>
<p>Für das Beispiel ergibt sich das lineare Gleichungssystem zu: <span class="math display">\[
\underbrace{
\begin{bmatrix}
\blacksquare &amp; \blacksquare &amp; 0  &amp; \dots &amp; \dots &amp; \dots &amp; 0\\
\blacksquare &amp; \ddots &amp; \ddots &amp; 0 &amp; &amp; &amp; \vdots\\
0 &amp; \ddots &amp; \ddots  &amp; \ddots &amp; 0 &amp;  &amp; \vdots\\
\vdots                                                  &amp;
  0                                                     &amp;
  \left( \frac{u_i}{2\dx} - \frac{\beta}{\dx^2} \right) &amp;
  \left( \frac{2\beta}{\dx^2}                   \right) &amp;
  \left( -\frac{u_i}{2\dx} - \frac{\beta}{\dx^2} \right) &amp;
  0                                                     &amp;
  \vdots
\\
\vdots &amp; &amp; 0 &amp; \ddots &amp; \ddots&amp; \ddots &amp; 0\\
\vdots &amp; &amp; &amp; 0 &amp; \ddots&amp; \ddots &amp; \blacksquare\\
0 &amp; \dots &amp; \dots  &amp; \dots &amp; 0 &amp; \blacksquare &amp; \blacksquare\\
\end{bmatrix}
}_{\text{Systemmatrix}\;\mat{A}}
\underbrace{
  \begin{bmatrix}
  \phi_1 \\
  \vdots \\
  \phi_{i-1} \\
  \phi_{i} \\
  \phi_{i+1} \\
  \vdots \\
  \phi_N \\
  \end{bmatrix}
}_{\text{Lösungsvektor} \; \vec{\phi}}
=
\underbrace{
  \begin{bmatrix}
  0 \\
  \vdots \\
  0 \\
  \vdots \\
  0 \\
  \end{bmatrix}
}_{\text{Rechte Seite} \; \vec{b}}
\mathrm{mit} \; \blacksquare \; \mathrm{für\ Einträge} \neq 0
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-23" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-23">Finite-Differenzen-Methode</h2>
<section id="aufstellen-des-linearen-gleichungssystems-34-2" class="level3">
<h3 class="anchored" data-anchor-id="aufstellen-des-linearen-gleichungssystems-34-2">Aufstellen des linearen Gleichungssystems (3/4)</h3>
<section id="systemmatrix" class="level4">
<h4 class="anchored" data-anchor-id="systemmatrix">Systemmatrix</h4>
<ul>
<li>Die Form der Systemmatrix hängt vom verwendeten Differenzenstern und Gitter ab.</li>
<li>Bei strukturieren Gittern ergibt sich meist eine Bandmatrix.</li>
<li>Je nachdem in welcher Reihenfolge ein strukturiertes mehrdimensionales Gitter nummeriert wird, liegen die Bänder näher oder weiter entfernt von der Hauptdiagonalen.</li>
<li>Die Struktur der Matrix ist meist symmetrisch.</li>
<li>Die Werte müssen jedoch nicht symmetrisch sein. Dies hängt von der diskretisierten Gleichung ab.</li>
<li>Je größer der verwendete Diskretisierungsstern ist, desto mehr Einträge ungleich Null sind in einer Zeile vorhanden.</li>
<li>Fast alle Diskretisierungsverfahren für partielle Differentialgleichungen liefern schwachbesetzte Matrizen.</li>
<li>Die Dimension der Matrix ist quadratisch und entspricht der Größe des Gitters. Beim Finite-Differenzen-Verfahren entspricht die Dimension der Anzahl der Knotenpunkte; beim Finite-Volumen-Verfahren entspricht sie der Anzahl der Zellen.</li>
</ul>
</section>
<section id="lösungsvektor" class="level4">
<h4 class="anchored" data-anchor-id="lösungsvektor">Lösungsvektor</h4>
<ul>
<li>Der Lösungsvektor enthält die gesuchte Größe für jeden Gitterpunkt.</li>
</ul>
</section>
<section id="rechte-seite" class="level4">
<h4 class="anchored" data-anchor-id="rechte-seite">Rechte Seite</h4>
<ul>
<li>Der Vektor enthält Terme, die nicht die gesuchte Größe enthalten, z.B. Quellterme. Zusätzlich stehen in ihm die Randbedingungen.</li>
</ul>
</section>
</section>
</section>
<section id="finite-differenzen-methode-24" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-24">Finite-Differenzen-Methode</h2>
<section id="randbedingung-34" class="level3">
<h3 class="anchored" data-anchor-id="randbedingung-34">Randbedingung (3/4)</h3>
<ul>
<li>Während die inneren Knoten alle einheitlich behandelt werden, müssen die äußeren Knoten (Randknoten) separat über Randbedingungen behandelt werden.</li>
<li>Es gibt verschiedene Typen von Randbedingungen:
<ul>
<li>Dirichlet-Randbedingung</li>
<li>Neumann-Randbedingung</li>
<li>Periodische Randbedingung</li>
</ul></li>
<li>Randbedingungen sollten in Regionen gelegt werden, in denen sie keinen Einfluss auf die Lösung haben. Tendenziell gilt: je weiter entfernt die Randbedingung liegt, desto weniger wird das Ergebnis beeinflusst.</li>
</ul>
<p><strong>Beispiel</strong>: Position der Randbedingung für eine Stufenströmung (Backward-Facing-Step) von schlecht (rot) über besser (gelb) nach gut (grün)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_rb-backflow.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</section>
</section>
<section id="finite-differenzen-methode-25" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-25">Finite-Differenzen-Methode</h2>
<section id="dirichlet-randbedingung-34" class="level3">
<h3 class="anchored" data-anchor-id="dirichlet-randbedingung-34">Dirichlet-Randbedingung (3/4)</h3>
<p>Eine Dirichlet-Randbedingung gibt direkt den Wert eines Randknotens vor, z.B. Unbekannte <span class="math inline">\(\phi=1\)</span>.</p>
<div id="470bf8f2" class="cell" data-message="false" data-execution_count="13">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-14-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1135" height="110"></p>
</figure>
</div>
</div>
</div>
<p>Die Vorgabe der Unbekannten für den ersten Knoten lautet z.B.</p>
<p><span class="math display">\[
\phi_{1} = 1
\]</span></p>
<p>Eine Dirichlet-Randbedingung “eliminiert” damit eine Zeile aus der Systemmatrix. An einem Dirichlet-Randknoten muss also keine Gleichungs mehr gelöst werden. Theoretisch kann diese dann um eine Dimension durch Einsetzen des bekannten Werts reduziert werden.</p>
<p><strong>Beispiele:</strong></p>
<ul>
<li>Geschwindigeit bzw. Massenstrom am Eintritt ist bekannt.</li>
<li>Wandtemperatur oder Eintrittstemperatur ist bekannt.</li>
<li>Geschwindigkeit an reibungsbehafteten Wänden ist bekannt (Haftbedingung).</li>
<li>Druck am Austritt wird vorgegeben.</li>
</ul>
</section>
</section>
<section id="finite-differenzen-methode-26" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-26">Finite-Differenzen-Methode</h2>
<section id="neumann-randbedingung-34" class="level3">
<h3 class="anchored" data-anchor-id="neumann-randbedingung-34">Neumann-Randbedingung (3/4)</h3>
<p>Eine Neumann-Randbedingung gibt den Gradient der Unbekannten an einem Randknoten vor, z.B. <span class="math inline">\(\pp{\phi}{\vec{n}} = 0\)</span>. Typischerweise wird der Gradient in Normalenrichtung <span class="math inline">\(\vec{n}\)</span> des Randes vorgegeben.</p>
<div id="7c6ea0a5" class="cell" data-message="false" data-execution_count="14">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-15-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="1135" height="110"></p>
</figure>
</div>
</div>
</div>
<p><strong>Beispiel:</strong> Vorgabe des Gradienten <span class="math inline">\(\pp{\phi}{x}=0\)</span> am rechten Rand für die Gleichung <span class="math inline">\(u \pp{\phi}{x} - \beta \ppnd{\phi}{x} = 0\)</span></p>
<p>Die diskretisierte Gleichung für den Knoten <span class="math inline">\(N\)</span> lautet: <span class="math display">\[
u_N \fd{\phi}{N+1}{N-1}{2\dx}
-
\beta_i \ffd{\phi}{N+1}{N}{N-1}{\dx^2}
=
0
\]</span> Der Knoten an der Stelle <span class="math inline">\(N+1\)</span> gehört nicht zum Rechengitter. Aus der Vorgabe des Gradienten, z.B. mit einer zentralen Differenz <span class="math display">\[
\at{\pp{\phi}{x}}{N} = \fd{\phi}{N+1}{N-1}{2\dx} + \Odx{2} = 0
\]</span> wird die Bedingung unter Vernachlässigung des Abbruchfehlers <span class="math inline">\(\phi_{N+1} = \phi_{N-1}\)</span> abgeleitet. Es wird in der diskretisierten Gleichung für den Knoten <span class="math inline">\(N\)</span> der Wert <span class="math inline">\(\phi_{N+1}\)</span> durch <span class="math inline">\(\phi_{N-1}\)</span> ersetzt.</p>
</section>
</section>
<section id="finite-differenzen-methode-27" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-27">Finite-Differenzen-Methode</h2>
<section id="aufstellen-des-linearen-gleichungssystems-34-3" class="level3">
<h3 class="anchored" data-anchor-id="aufstellen-des-linearen-gleichungssystems-34-3">Aufstellen des linearen Gleichungssystems (3/4)</h3>
<p>Das Einsetzen der Dirichlet- und Neumann-Randbedingung jeweils am linken und rechten Rand verändert die Systemmatrix und die rechte Seite zu: <span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0  &amp; \dots &amp; \dots &amp; \dots &amp; 0\\
\blacksquare &amp; \ddots &amp; \ddots &amp; 0 &amp; &amp; &amp; \vdots\\
0 &amp; \ddots &amp; \ddots  &amp; \ddots &amp; 0 &amp;  &amp; \vdots\\
\vdots                                                  &amp;
  0                                                     &amp;
  \left( \frac{u_i}{2\dx} - \frac{\beta}{\dx^2} \right) &amp;
  \left( \frac{2\beta}{\dx^2}                   \right) &amp;
  \left( -\frac{u_i}{2\dx} - \frac{\beta}{\dx^2} \right) &amp;
  0                                                     &amp;
  \vdots
\\
\vdots &amp; &amp; 0 &amp; \ddots &amp; \ddots&amp; \ddots &amp; 0\\
\vdots &amp; &amp; &amp; 0 &amp; \ddots&amp; \ddots &amp; \blacksquare\\
0 &amp;
\dots &amp;
\dots  &amp;
\dots &amp;
0 &amp;
-\frac{2\beta}{\bdx{2}} &amp;
\frac{2\beta}{\bdx{2}}\\
\end{bmatrix}
\begin{bmatrix}
  \phi_1 \\
  \vdots \\
  \phi_{i-1} \\
  \phi_{i} \\
  \phi_{i+1} \\
  \vdots \\
  \phi_N \\
\end{bmatrix}
=
\begin{bmatrix}
  1 \\
  \vdots \\
  0 \\
  0 \\
  0 \\
  \vdots \\
  0 \\
\end{bmatrix}
\mathrm{mit} \; \blacksquare \; \mathrm{für\ Einträge} \neq 0
\]</span></p>
<p>Beim Einsetzen der Randbedingungen verändern sich meist die Koeffizienten der Matrix in den Randknoten und die rechte Seite.</p>
</section>
</section>
<section id="finite-differenzen-methode-28" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-28">Finite-Differenzen-Methode</h2>
<section id="typische-randbedingungen-34" class="level3">
<h3 class="anchored" data-anchor-id="typische-randbedingungen-34">Typische Randbedingungen (3/4)</h3>
<p>Bei der Berechnung von inkompressiblen Strömungsproblemen gibt es mehrere Möglichkeiten. Eine typische Randbedingungsvorgabe erfolgt durch:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_typrb-backflow.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<div class="columns">
<div class="column">
<p><strong>Dirichlet-Randbedingung</strong></p>
<ul>
<li>Geschwindigkeit am Eintritt</li>
<li>Druck am Austritt</li>
</ul>
</div><div class="column">
<p><strong>Neumann-Randbedingung</strong></p>
<ul>
<li>Geschwindigkeit am Austritt</li>
<li>Druck am Eintritt</li>
</ul>
</div>
</div>
<p><strong>Achtung</strong>: Bei kompressiblen Überschallströmungen müssen Geschwindigkeit und Druck am Eintritt vorgegeben werden, da sich Störungen nur stromab ausbreiten.</p>
</section>
</section>
<section id="finite-differenzen-methode-29" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-29">Finite-Differenzen-Methode</h2>
<section id="lösung-44" class="level3">
<h3 class="anchored" data-anchor-id="lösung-44">Lösung (4/4)</h3>
<p>Die Lösung des linearen Gleichungssystems <span class="math display">\[
\mat{A} \vec{\phi} = \vec{b}
\]</span> erfolgt fast immer bei numerischer Strömungssimulation indirekt. Es wird also nicht die Inverse <span class="math inline">\(\mat{A}^{-1}\)</span> berechnet, da dies in der Regel zu aufwändig ist.</p>
<p>Für indirekte Gleichungslöser gilt:</p>
<ul>
<li>Die Lösung wird iterativ berechnet, d.h. es wird eine Iterationsvorschrift <span class="math inline">\(\vec{\phi}^{(n+1)} = f(\vec{\phi}^{(n)})\)</span> abgearbeitet. Je nach verwendetem Löser enthält die Iterationsvorschrift <span class="math inline">\(f(\vec{\phi}^{(n)})\)</span> meist mehrere Matrix-Vektor- und Skalarprodukte.</li>
<li>Typische iterative Verfahren sind z.B. Gradientenverfahren, bikonjugierte Gradientenverfahren, …</li>
<li>Meist muss zusätzlich eine Vorkonditionierung verwendet werden.</li>
</ul>
<p>Die Gesamtdauer (Rechenzeit) einer numerischen Strömungssimulation hängt sehr stark vom verwendeten indirekten Gleichungslöser ab. Die Iterationsvorschrift wird in jedem Iterations- und Zeitschritt mehrmals durchlaufen.</p>
</section>
</section>
<section id="finite-differenzen-methode-30" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-30">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Die eindimensionale Helmholtz-Gleichung lautet: <span class="math display">\[
\ppnd{\phi}{x} - \lambda^2 \phi = 0 \; \text{mit} \; \lambda = \frac{1}{2}
\]</span> Die exakte Lösung lautet: <span class="math display">\[
\phi(x) = \frac{1}{2} e^{-\lambda x} + \frac{1}{2} e^{\lambda x}
\]</span></p>
<p>Das verwendete Netz enthält 5 Knoten und hat eine Gitterweite von <span class="math inline">\(\dx = \frac{1}{2}\)</span>.</p>
<div id="ec647693" class="cell" data-message="false" data-execution_count="15">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-16-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="869" height="233"></p>
</figure>
</div>
</div>
</div>
<p>Als Randbedingungen wird am linken und rechten Rand eine Dirichlet-Randbedingung <span class="math inline">\(\at{\phi}{x=0.0}=\phi_1=1.0\)</span> und <span class="math inline">\(\at{\phi}{x=2.0}=\phi_5=1.54308\)</span> vorgegeben.</p>
</section>
</section>
<section id="finite-differenzen-methode-31" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-31">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-1" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-1">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Die diskretisierte Helmholtz-Gleichung ergibt sich nach Approximation der Differentialquotienten durch Differenzenquotienten zu: <span class="math display">\[
\underbrace{
  \ffd{\phi}{i+1}{i}{i-1}{\bdx{2}}
}_{
\at{\ppnd{\phi}{x}}{i}
}
-
\underbrace{
  \lambda^2 \phi_i
}_{\at{\lambda^2 \phi}{i}}
= 0
\]</span></p>
<p>Durch Umstellung ergeben sich die Vorfaktoren: <span class="math display">\[
\left(
  \frac{1}{\bdx{2}}
\right) \phi_{i+1}
+
\left(
-\frac{2}{\bdx{2}} - \lambda^2
\right) \phi_i
+
\left(
  \frac{1}{\bdx{2}}
\right) \phi_{i-1}
\]</span></p>
<p>Das Einsetzen von <span class="math inline">\(\lambda=\frac{1}{2}\)</span> und <span class="math inline">\(\dx=\frac{1}{2}\)</span> in die diskretisierte Gleichung ergibt: <span class="math display">\[
4 \phi_{i+1} - 8.25 \phi_i + 4 \phi_{i-1} = 0
\]</span></p>
<p>Der erste und letzte Knoten ist entsprechend der Randbedingungen durch <span class="math display">\[
\phi_1 = 1.0 \; \text{und} \; \phi_5 = 1.54308
\]</span> gegeben.</p>
</section>
</section>
<section id="finite-differenzen-methode-32" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-32">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-2" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-2">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Es ergibt sich das lineare Gleichungssystem <span class="math display">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0  &amp; 0 &amp; 0 \\
4 &amp; -8.25 &amp; 4  &amp; 0 &amp; 0 \\
0 &amp; 4 &amp; -8.25  &amp; 4 &amp; 0 \\
0 &amp; 0 &amp; 4  &amp; -8.25 &amp; 4 \\
0 &amp; 0 &amp; 0  &amp; 0 &amp; 1 \\
\end{bmatrix}
\begin{bmatrix}
  \phi_1 \\
  \phi_2 \\
  \phi_3 \\
  \phi_4 \\
  \phi_5 \\
\end{bmatrix}
=
\begin{bmatrix}
  1 \\
  0 \\
  0 \\
  0 \\
  1.54308 \\
\end{bmatrix}
\]</span> bzw. nach Umformung und Reduktion der Dimension: <span class="math display">\[
\begin{bmatrix}
-8.25 &amp; 4  &amp; 0 \\
4 &amp; -8.25  &amp; 4 \\
0 &amp; 4  &amp; -8.25 \\
\end{bmatrix}
\begin{bmatrix}
  \phi_2 \\
  \phi_3 \\
  \phi_4 \\
\end{bmatrix}
=
\begin{bmatrix}
  -4 \\
  0 \\
  -6.17232 \\
\end{bmatrix}
\]</span></p>
</section>
</section>
<section id="finite-differenzen-methode-33" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-33">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-3" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-3">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Der Vergleich zwischen den diskreten berechneten Punkten (siehe <span class="math inline">\(\square\)</span> in der Abbildung) und der exakten Lösung ist für dieses Beispiel vernachlässigbar klein. Die Zahl an den Symbolen ist die Abweichung zwischen exakter und numerischer Lösung in Prozent.</p>
<div id="5e440c93" class="cell" data-message="false" data-execution_count="16">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-17-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="869" height="455"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="finite-differenzen-methode-34" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-34">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-4" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-4">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Die Gleichung wird erneut gelöst mit der gleichen Diskretisierung. Allerdings wird nun am linken Rand anstatt einer Dirichlet-Randbedingung eine Neumann-Randbedingung von <span class="math display">\[
\at{\pp{\phi}{x}}{i=1} = 0
\]</span> vorgegeben. Die Diskretisierung der inneren Knoten für <span class="math inline">\(i=2,3,4\)</span> <span class="math display">\[
\left(
  \frac{1}{\bdx{2}}
\right) \phi_{i+1}
+
\left(
-\frac{2}{\bdx{2}} - \lambda^2
\right) \phi_i
+
\left(
  \frac{1}{\bdx{2}}
\right) \phi_{i-1}
\]</span> und des rechten Randes <span class="math display">\[
\phi_5 = 1.54308
\]</span> ist unverändert.</p>
</section>
</section>
<section id="finite-differenzen-methode-35" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-35">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-5" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-5">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<section id="einarbeiten-der-neumann-randbedingung" class="level4">
<h4 class="anchored" data-anchor-id="einarbeiten-der-neumann-randbedingung">Einarbeiten der Neumann-Randbedingung</h4>
<p>Die diskrete Gleichung am Knoten 1 ergibt sich mit eingesetzen Werten zu: <span class="math display">\[
4\phi_2-8.25\phi_1+4\phi_0 = 0
\]</span> Da der Knoten 0 im Netz nicht enthalten ist, wird dieser durch Einarbeiten der Neumann-Randbedingung <span class="math display">\[
\frac{\phi_2 - \phi_0}{2\dx} = 0 \; \rightarrow \; \phi_0 = \phi_2
\]</span> ersetzt. Es ergibt sich: <span class="math display">\[
8\phi_2 - 8.25\phi_1 = 0
\]</span></p>
<p>Das lineare Gleichungssystem lautet mit der neuen Randbedingung: <span class="math display">\[
\begin{bmatrix}
-8.25 &amp; 8  &amp; 0 &amp; 0\\
4 &amp; -8.25  &amp; 4 &amp; 0\\
0 &amp; 4  &amp; -8.25 &amp; 4\\
0 &amp; 0 &amp; 4  &amp; -8.25\\
\end{bmatrix}
\begin{bmatrix}
  \phi_1 \\
  \phi_2 \\
  \phi_3 \\
  \phi_4 \\
\end{bmatrix}
=
\begin{bmatrix}
  0 \\
  0 \\
  0 \\
  -6.17232 \\
\end{bmatrix}
\]</span></p>
</section>
</section>
</section>
<section id="finite-differenzen-methode-36" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-36">Finite-Differenzen-Methode</h2>
<section id="beispiel-eindimensionale-helmholtz-gleichung-6" class="level3">
<h3 class="anchored" data-anchor-id="beispiel-eindimensionale-helmholtz-gleichung-6">Beispiel: Eindimensionale Helmholtz-Gleichung</h3>
<p>Der erneute Vergleich zur exakten Lösung liefert wieder eine sehr gute Näherungslösung.</p>
<div id="4914e8d6" class="cell" data-message="false" data-execution_count="17">
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="fdm_files/figure-html/cell-18-output-1.png" class="quarto-figure quarto-figure-center figure-img" width="869" height="455"></p>
</figure>
</div>
</div>
</div>
<p>Wird hingegen zur Einarbeitung der Neumann-Randbedingung am Knoten 1 die Gleichung <span class="math display">\[
\frac{\phi_1 - \phi_0}{\dx} = 0 \; \rightarrow \; \phi_0 = \phi_1
\]</span> und somit eine Diskretisierung 1. Ordnung verwendet, werden die Abweichungen größer (siehe <span class="math inline">\(\color{red}{\times}\)</span> in der Abbildung).</p>
</section>
</section>
<section id="finite-differenzen-methode-37" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-37">Finite-Differenzen-Methode</h2>
<section id="genauigkeit-von-numerischen-lösung" class="level3">
<h3 class="anchored" data-anchor-id="genauigkeit-von-numerischen-lösung">Genauigkeit von numerischen Lösung</h3>
<ul>
<li>Die numerischen Lösungen von Strömungsproblemen sind nur Näherungslösungen.</li>
<li>Die numerischen Lösungen beinhalten drei Arten von systematischen Fehlern:
<ul>
<li>Diskretisierungsfehler: Differenz zwischen der genauen Lösung des mathematischen Modells und der genauen Lösung der durch Diskretisierung dieser Gleichungen entstandenen algebraischen Gleichungssysteme
<ul>
<li><em>Führender Fehlerterm</em></li>
</ul></li>
<li>Modellfehler: Differenz zwischen sich tatsächlich einstellender Strömung und der genauen Lösung des mathematischen Modells
<ul>
<li><em>Vereinfachungen der Grundgleichungen</em></li>
</ul></li>
<li>Iterationsfehler: Differenz zwischen der genauen und der iterativen Lösung der algebraischen Gleichungssysteme
<ul>
<li><em>Ungenauigkeiten bei der indirekten Lösung des linearen Gleichungssystems</em></li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="finite-differenzen-methode-38" class="level2">
<h2 class="anchored" data-anchor-id="finite-differenzen-methode-38">Finite-Differenzen-Methode</h2>
<section id="nichtkartesische-gitter" class="level3">
<h3 class="anchored" data-anchor-id="nichtkartesische-gitter">Nichtkartesische Gitter</h3>
<ul>
<li>Die bisherige Vorgehensweise wurde auf kartesische Gitter angewendet.</li>
<li>Reale (komplexe) Geometrien können aber in der Regel nicht rechtwinklig vernetzt werden.
<ul>
<li>Die Anwendung der Finite-Differenzen-Methode erfordert dann eine Koordinatentransformation zwischen physikalischem Raum und Berechnungsraum.</li>
</ul></li>
</ul>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_krummKOS.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:30.0%"></p>
</figure>
</div>
<p>Physikalischer Raum in <span class="math inline">\((x,y)\)</span></p>
</div><div class="column">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_retchwKOS.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:30.0%"></p>
</figure>
</div>
<p>Berechnungsraum in <span class="math inline">\((\zeta, \eta)\)</span></p>
</div>
</div>
<p>Die Transformation zwischem den beiden Räumen ist durch die Jacobi-Matrix gegeben und definiert die Transformation der Ableitungen z.B. durch: <span class="math display">\[
\begin{align}
\pp{\phi}{x} &amp;= \pp{\phi}{\zeta} \pp{\zeta}{x} + \pp{\phi}{\eta} \pp{\eta}{x}\\
\pp{\phi}{y} &amp;= \pp{\phi}{\zeta} \pp{\zeta}{y} + \pp{\phi}{\eta} \pp{\eta}{y}
\end{align}
\]</span></p>
</section>
</section>
<section id="kontrollfragen-12" class="level2">
<h2 class="anchored" data-anchor-id="kontrollfragen-12">Kontrollfragen (1/2)</h2>
<ul>
<li>Welche drei gängigen Diskretisierungsmethoden gibt es?</li>
<li>Beschreiben Sie die Vorgehensweise bei der Finite-Differenzen-Methode.</li>
<li>Welche Anforderungen bestehen für das Rechengitter bei der Finite-Differenzen-Methode?</li>
<li>Inwiefern ist die Fehlerordnung des Diskretisierungsschemas wichtig?</li>
<li>Warum benötigt man bei der Diskretisierung einer Konvektion-Diffusions-Gleichung bei sinkender Diffusion eine Upwind-Diskretisierung?</li>
<li>Beschreiben Sie wie sich ein diffusiver Fehler auf die Lösung auswirkt.</li>
<li>Wie wirkt sich ein dispersiver Fehler aus?</li>
<li>Was ist bei der Wahl der Randbedingungen zu beachten?</li>
<li>Welche drei Arten von systematischen Fehlern gibt es in numerischen Lösungen?</li>
<li>Für was benötigen Sie die Taylor-Reihe bei der Finite-Differenzen-Methode?</li>
</ul>
</section>
<section id="kontrollfragen-22" class="level2">
<h2 class="anchored" data-anchor-id="kontrollfragen-22">Kontrollfragen (2/2)</h2>
<ul>
<li>Wie sieht die Matrixstruktur bei verschiedenen Differenzensternen aus?</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/fdm_kfragen-diskstern.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
<ul>
<li>Diskretisieren Sie folgende Gleichungen mit der Finite-Differenzen-Methode: <span class="math display">\[
u \pp{\phi}{x} - \beta \ppnd{\phi}{x} = 0
\; \text{mit} \; u=const. \; \text{und} \; \beta=const.
\]</span> und <span class="math display">\[
\ppnd{\phi}{x} + \ppnd{\phi}{y} = 0
\]</span></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/atismer\.github\.io\/nso1\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>